tinymce.PluginManager.add('filemanager', function (editor, url) {
  var openDialog = function () {
    return new FileManagerDialogView({
      single: true, viewer: "image", success: function (files) {
        if (files && files.length) {
          file = files[0];
          if (file && !file.get("isfolder") && file.get('real_file_path')) {
            editor.insertContent('<img src="' + file.get('real_file_path') + '">');
          }
        }
      }
    });
  };

  // Add a button that opens a window
  editor.ui.registry.addButton('filemanager', {
    icon: 'browse',
    tooltip: 'Выбрать из файлов',
    onAction: function () {
      // Open window
      openDialog();
    }
  });

  // Adds a menu item, which can then be included in any menu via the menu/menubar configuration
  editor.ui.registry.addMenuItem('filemanager', {
    text: 'Filemanager plugin',
    onAction: function () {
      // Open window
      openDialog();
    }
  });

  return {
    getMetadata: function () {
      return {
        name: "Filemanager plugin",
        url: ""
      };
    }
  };
});